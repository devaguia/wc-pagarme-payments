(()=>{class e{constructor(){this.reset()}create(){const e=document.querySelector("body"),t=document.createElement("i");t.setAttribute("id","wpp-popup-icon");const s=document.createElement("div");s.classList.add("wpp-popup-icon"),s.appendChild(t);const o=document.createElement("span");o.setAttribute("id","wpp-popup-title");const n=document.createElement("div");n.classList.add("wpp-popup-title"),n.appendChild(o);const c=document.createElement("span");c.setAttribute("id","wpp-popup-message");const p=document.createElement("div");p.classList.add("wpp-popup-message"),p.appendChild(c);const i=document.createElement("div");i.classList.add("wpp-popup"),i.appendChild(s),i.appendChild(n),i.appendChild(p);const a=document.createElement("div");a.classList.add("wpp-darker"),a.appendChild(i),e?.appendChild(a)}setIcon(e){const t=document.querySelector("#wpp-popup-icon");if(t)switch(e){case"error":t.className="fa-solid fa-circle-xmark";break;case"success":t.className="fa-solid fa-circle-check";break;case"loading":t.className="fa-solid fa-spinner";break;case"warning":t.className="fa-solid fa-triangle-exclamation";break;default:t.className=""}}setMessage(e){const t=document.querySelector("#wpp-popup-message");t&&(t.innerText=e)}setTitle(e){const t=document.querySelector("#wpp-popup-title");t&&(t.innerText=e)}setButton(e,t,s){const o=document.querySelector(".wpp-popup"),n=document.createElement("input");if(n){n.setAttribute("type","button"),n.setAttribute("id",s),n.classList=t,n.value=e;const c=document.createElement("div");c.classList.add("wpp-popup-button"),c.appendChild(n),o?.appendChild(c)}}setButtons(e){const t=document.querySelector(".wpp-popup"),s=document.createElement("div");s.classList.add("wpp-popup-button"),e.forEach((e=>{const t=document.createElement("input");console.log(t),t&&(t.setAttribute("type","button"),t.setAttribute("id",e.id),t.classList=e.classes,t.value=e.text,s.appendChild(t))})),t?.appendChild(s)}reset(){["#wpp-popup-icon","#wpp-popup-title","#wpp-popup-message",".wpp-popup",".wpp-darker"].forEach((e=>{const t=document.querySelector(e);t&&t.remove()}))}}class t{setWaitingPopup(){const t=new e;t.create(),t.setIcon("loading"),t.setTitle("Aguarde!"),t.setMessage("Carregando...")}setSuccessPopup(t,s){const o=new e;o.create(),o.setIcon("success"),o.setTitle(t),o.setMessage(s),o.setButtons([{text:"Confirmar",classes:"btn btn-success btn-reload",id:"wpp-success-form"}])}setErrorPopup(t,s){const o=new e;o.create(),o.setIcon("error"),o.setTitle(t),o.setMessage(s),o.setButtons([{text:"Cancelar",classes:"btn btn-failed btn-reload",id:"wpp-error-form"}])}setReloadFuncion(){document.querySelectorAll(".wpp-popup-button .btn-reload").forEach((e=>{e.addEventListener("click",(()=>{window.location.reload()}))}))}}new class extends t{constructor(){super(),document.querySelector(".wpp-container-pagarme")&&(this.submit(),this.showTokenContent(),this.checkTokenContent(),this.exportSettingsFile(),this.copyWebhook())}exportSettingsFile(){const e=document.querySelector("#wpp-export-settings");e?.addEventListener("click",(()=>{this.getSettingsContent()}))}getSettingsContent(){const e=new FormData;e.append("action","export_settings_file"),fetch(`${window.location.origin}/wp-admin/admin-ajax.php`,{method:"POST",body:e}).then((e=>e.json())).then((e=>{this.downloadSettingsFile(JSON.stringify(e.content,null,4))}))}downloadSettingsFile(e){const t=new File([e],"export.json",{type:"application/json"}),s=URL.createObjectURL(t),o=document.createElement("a");o&&(o.setAttribute("href",s),o.setAttribute("download","export.json"),document.body.appendChild(o),o.click(),document.body.removeChild(o))}copyWebhook(){const e=document.querySelector("#wpp-webhook-link"),t=document.querySelector("#wpp-webhook-copy");e&&t&&t.addEventListener("click",(()=>{let t=e.value;try{navigator.clipboard.writeText(t)}catch(t){e.select(),document.execCommand("copy")}}))}showTokenContent(){const e=document.querySelectorAll("#wpp-pagarme-settings input[type=password");e&&e.forEach((e=>{e.addEventListener("focusin",(()=>{e.setAttribute("type","text")})),e.addEventListener("focusout",(()=>{e.setAttribute("type","password")}))}))}checkTokenContent(){const e=document.querySelector("#wpp-secret-key"),t=document.querySelector("#wpp-public-key");e&&t&&(this.checkEqualKeys(e,t),this.checkValidKeys(e,t),[e,t].forEach((s=>{s.addEventListener("keyup",(()=>{this.checkEqualKeys(e,t),this.checkValidKeys(e,t)}))})))}checkValidKeys(e,t){const s=document.querySelector("#wpp-warning-valid-key");if(!s)return;const o=e.value.includes("sk_"),n=t.value.includes("pk_");o&&n?(s.classList.remove("wpp-warning-active"),this.controlSubmitDisabled(!1)):(s.classList.add("wpp-warning-active"),this.controlSubmitDisabled(!0))}checkEqualKeys(e,t){const s=document.querySelector("#wpp-warning-equal-key");if(!s)return;const o=e.value.includes("sk_test_");if(o!==t.value.includes("pk_test_"))s.classList.add("wpp-warning-active"),this.controlSubmitDisabled(!0);else{s.classList.remove("wpp-warning-active"),this.controlSubmitDisabled(!1);const e=o?"test":"production";this.setPaymentMode(e)}}controlSubmitDisabled(e=!0){const t=document.querySelector("#wpp-submit");e?(t?.setAttribute("disabled",""),t?.classList.add("wpp-submit-disabled")):(t?.removeAttribute("disabled"),t?.classList.remove("wpp-submit-disabled"))}setPaymentMode(e){const t=document.querySelector("#wpp-payment-mode");console.log(e),t&&e&&(t.value=e)}submit(){const e=document.querySelector("#wpp-pagarme-settings");e?.addEventListener("submit",(t=>{t.preventDefault(),this.saveSettings(e)}))}saveSettings(e){const t=new FormData(e);t.append("action","save_pagarme_settings"),this.setWaitingPopup(),fetch(`${window.location.origin}/wp-admin/admin-ajax.php`,{method:"POST",body:t}).then((e=>e.json())).then((e=>{if(console.log(e),e.content){const t=e.content,s=t?.message,o=t?.title;200===t?.code?this.setSuccessPopup(o,s):this.setErrorPopup(o,s),this.setReloadFuncion();const n=document.querySelector("#wpp-success-form");n&&n.addEventListener("click",(()=>{window.location.reload()}))}}))}}})();
//# sourceMappingURL=index.js.map
